{{#section "css"}}
<style>
.divider:after,
.divider:before {
  content: "";
  flex: 1;
  height: 1px;
  background: #eee;
}

.h-custom {
  height: calc(100% - 73px);
}

@media (max-width: 450px) {
  .h-custom {
    height: 100%;
  }
}
</style>
{{/section}}

{{#section "js"}}
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!--Validation Information-->
<script>
document.querySelector('#formSignIn').addEventListener('submit', function(e) {
    e.preventDefault();

    const email = document.querySelector('#email').value.trim();
    const password = document.querySelector('#password').value;

    if (!email || !password) {
        Swal.fire({
            title: 'Validation Error',
            text: 'Please enter both email and password.',
            icon: 'error'
        });
        return;
    }

    // Nếu hợp lệ, submit form
    e.target.submit();
});
</script>

<script>
    {{#if error}}
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: "{{{error}}}"
        });
    {{/if}}

    {{#if success}}
        Swal.fire({
            icon: 'success',
            title: 'Success',
            text: "{{{success}}}"
        });
    {{/if}}
</script>


<script src="https://accounts.google.com/gsi/client?hl=en" async defer></script>
<script>
function handleCredentialResponse(response) {
    // response.credential là ID token do Google cấp
    fetch('/accounts/google-signin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: response.credential })
    })
    .then(res => res.json())
    .then(data => {
        if(data.success) {
            // login thành công, redirect hoặc reload
            window.location.href = '/accounts/dashboard';
        } else {
            alert('Google login failed');
        }
    })
    .catch(err => console.error(err));
}

window.onload = function() {
    // Khởi tạo Google Sign-In
    google.accounts.id.initialize({
        client_id: '{{googleClientId}}', // lấy từ backend, truyền xuống template
        callback: handleCredentialResponse,
        locale: 'en' // buộc hiển thị tiếng Anh
    });

    // Render nút Google Sign-In
    google.accounts.id.renderButton(
        document.getElementById('googleSignInBtn'),
        {
            theme: 'outline',
            size: 'large',
            width: '100%',
            locale: 'en' // buộc hiển thị tiếng Anh
        }
    );

    // Optional: tự prompt đăng nhập khi load (false nếu không muốn)
    google.accounts.id.prompt(); 
};
</script>

{{/section}}




<div class="row justify-content-center">
    <div class="col-md-5">
        <div class="card border-0 shadow-lg">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <i class="bi bi-shield-lock text-primary" style="font-size: 3rem;"></i>
                    <h2 class="mt-3">Login</h2>
                    <p class="text-muted">Welcome back!</p>
                </div>

                <form method="POST" id="formSignIn">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                            <input type="email" class="form-control" id="email" name="email" 
                                   placeholder="email@example.com" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-lock"></i></span>
                            <input type="password" class="form-control" id="password" name="password" 
                                   placeholder="••••••••" required>
                        </div>
                    </div>

                    <div class="mb-3 d-flex justify-content-between align-items-center">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="remember" name="remember">
                            <label class="form-check-label" for="remember">
                                Remember me
                            </label>
                        </div>
                        <a href="/accounts/forgotpassword" class="text-decoration-none">Forgot password?</a>
                    </div>

                    <div class="mb-3">
                        <div class="g-recaptcha" data-sitekey={{RECAPTCHA_SITE_KEY}}></div>
                    </div>

                    <div class="d-grid mb-3">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-box-arrow-in-right"></i> Login
                        </button>
                    </div>

                    <div class="text-center mb-3">
                        <span class="text-muted">or login with</span>
                    </div>

                    <div class="row g-2 mb-3">
                        <div class="col-6">
                            <div id="googleSignInBtn"></div>
                        </div>

                        <div class="col-6">
                            <button type="button" class="btn btn-outline-primary w-100">
                                <i class="bi bi-facebook"></i> Facebook
                            </button>
                        </div>
                    </div>

                    <hr>

                    <div class="text-center">
                        <p class="mb-0">
                            Don't have an account? 
                            <a href="/accounts/signup" class="text-decoration-none fw-bold">Sign up now</a>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

