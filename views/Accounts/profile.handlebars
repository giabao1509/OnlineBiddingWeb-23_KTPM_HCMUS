<!-- Dashboard + Profile Header -->
<div class="row mb-4">
  <div class="col-12">
    <h3 class="mb-0"><i class="bi bi-speedometer2 me-2 text-primary"></i>Dashboard</h3>
    <p class="text-muted">Hello, {{user.name}}</p>
  </div>
</div>

<div class="row">
  <!-- Left Column: Buyer Activities -->
  <div class="col-lg-8">
    <!-- Active Bids -->
    <div class="card shadow-sm mb-4 border-0">
      <div class="card-header text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <h6 class="mb-0"><i class="bi bi-hammer me-2"></i>Active Bids</h6>
      </div>
      <div class="card-body p-0">
        <div class="list-group list-group-flush">
          {{#each activeBids}}
          <a href="/auctions/{{this.id}}" class="list-group-item list-group-item-action d-flex align-items-center border-0 border-bottom">
            <img src="{{this.image}}" class="rounded me-3 shadow-sm" style="width:70px; height:70px; object-fit:cover;">
            <div class="flex-grow-1">
              <div class="fw-bold text-dark">{{this.title}}</div>
              <div class="small mt-1">
                <span class="text-muted">Your bid:</span> <span class="text-primary fw-bold">{{this.yourBid}}</span>
                <span class="text-muted mx-1">â€“</span>
                <span class="text-muted">Current:</span> <span class="text-success fw-bold">{{this.currentBid}}</span>
              </div>
            </div>
            <i class="bi bi-chevron-right text-muted"></i>
          </a>
          {{else}}
          <div class="list-group-item text-center text-muted py-4 border-0">
            <i class="bi bi-inbox fs-3 d-block mb-2 opacity-50"></i>
            <small>No active bids</small>
          </div>
          {{/each}}
        </div>
      </div>
    </div>

    <!-- Won Auctions -->
    <div class="card shadow-sm mb-4 border-0">
      <div class="card-header text-white" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
        <h6 class="mb-0"><i class="bi bi-trophy me-2"></i>Won Auctions</h6>
      </div>
      <div class="card-body p-0">
        <div class="list-group list-group-flush">
          {{#each wonAuctions}}
          <a href="/orders/{{this.orderId}}" class="list-group-item list-group-item-action d-flex align-items-center border-0 border-bottom">
            <img src="{{this.image}}" class="rounded me-3 shadow-sm" style="width:50px; height:50px; object-fit:cover;">
            <div class="flex-grow-1">
              <div class="fw-bold small text-dark">{{this.title}}</div>
              <div class="text-success fw-bold small mt-1">{{this.winningBid}} VND</div>
              {{#if this.isPaid}}
              <span class="badge bg-success mt-1">Paid</span>
              {{else}}
              <span class="badge bg-warning mt-1">Pending</span>
              {{/if}}
            </div>
            <i class="bi bi-chevron-right text-muted"></i>
          </a>
          {{else}}
          <div class="list-group-item text-center text-muted py-4 border-0">
            <i class="bi bi-trophy fs-3 d-block mb-2 opacity-50"></i>
            <small>No won auctions yet</small>
          </div>
          {{/each}}
        </div>
      </div>
    </div>

    <!-- Watchlist -->
    <div class="card shadow-sm mb-4 border-0">
      <div class="card-header text-white" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <h6 class="mb-0"><i class="bi bi-heart-fill me-2"></i>Watchlist</h6>
      </div>
      <div class="card-body p-0">
        <div class="list-group list-group-flush">
          {{#each watchlist}}
          <a href="/auctions/{{this.id}}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center small border-0 border-bottom">
            <span class="text-dark">{{this.title}}</span>
            <div class="d-flex align-items-center">
              <span class="text-success fw-bold me-2">{{this.currentBid}}</span>
              <i class="bi bi-chevron-right text-muted"></i>
            </div>
          </a>
          {{else}}
          <div class="list-group-item text-center text-muted py-4 border-0">
            <i class="bi bi-heart fs-3 d-block mb-2 opacity-50"></i>
            <small>No favorite items</small>
          </div>
          {{/each}}
        </div>
      </div>
    </div>
  </div>

  <!-- Right Column: Statistics + Profile -->
  <div class="col-lg-4">
    <!-- Statistics Cards -->
    <div class="row mb-3">
      <div class="col-6 mb-3">
        <div class="card text-center shadow-sm h-100 border-0 text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <div class="card-body p-3">
            <i class="bi bi-hammer fs-3 mb-2 opacity-75"></i>
            <div class="small text-white-50 mb-1">Active</div>
            <h4 class="mb-0 fw-bold">{{stats.activeBids}}</h4>
          </div>
        </div>
      </div>
      <div class="col-6 mb-3">
        <div class="card text-center shadow-sm h-100 border-0 text-white" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
          <div class="card-body p-3">
            <i class="bi bi-trophy fs-3 mb-2 opacity-75"></i>
            <div class="small text-white-50 mb-1">Won</div>
            <h4 class="mb-0 fw-bold">{{stats.wonAuctions}}</h4>
          </div>
        </div>
      </div>
      <div class="col-6 mb-3">
        <div class="card text-center shadow-sm h-100 border-0 text-white" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
          <div class="card-body p-3">
            <i class="bi bi-heart-fill fs-3 mb-2 opacity-75"></i>
            <div class="small text-white-50 mb-1">Favorites</div>
            <h4 class="mb-0 fw-bold">{{stats.watchlist}}</h4>
          </div>
        </div>
      </div>
      <div class="col-6 mb-3">
        <div class="card text-center shadow-sm h-100 border-0 text-white" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
          <div class="card-body p-3">
            <i class="bi bi-wallet2 fs-3 mb-2 opacity-75"></i>
            <div class="small text-white-50 mb-1">Total Spent</div>
            <h4 class="mb-0 fw-bold">{{stats.totalSpent}}</h4>
            <small class="text-white-50">million</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Section -->
    <div class="card shadow-sm mb-4 border-0">
      <div class="card-header text-white d-flex justify-content-between align-items-center" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
        <h6 class="mb-0"><i class="bi bi-person-circle me-2"></i>Profile</h6>
        <button class="btn btn-light btn-sm" id="editProfileBtn">
          <i class="bi bi-pencil"></i> Edit
        </button>
      </div>
      <div class="card-body">
        <!-- Display info -->
        <div id="profileDisplay">
          <div class="mb-3">
            <label class="text-muted small d-block mb-1">Full Name</label>
            <div class="fw-bold text-dark">{{user.full_name}}</div>
          </div>
          <div class="mb-0">
            <label class="text-muted small d-block mb-1">Email</label>
            <div class="text-dark">{{user.email}}</div>
          </div>
        </div>

        <!-- Hidden form -->
        <form id="profileForm" action="/profile/update" method="POST" style="display:none;">
          <div class="row g-3 mb-3">
            <div class="col-md-12">
              <label class="form-label small fw-bold">Full Name</label>
              <input type="text" name="name" class="form-control form-control-sm" value="{{user.full_name}}" required>
            </div>
            <div class="col-md-12">
              <label class="form-label small fw-bold">Email</label>
              <input type="email" name="email" class="form-control form-control-sm" value="{{user.email}}" required>
            </div>
          </div> 

          <hr class="my-3">

          <div class="alert alert-info py-2 px-3 small mb-3">
            <i class="bi bi-info-circle me-1"></i>
            Leave blank if you do not want to change password
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-12">
              <label class="form-label small fw-bold">Current Password</label>
              <input type="password" name="oldPassword" class="form-control form-control-sm" placeholder="Enter current password">
            </div>
            <div class="col-md-12">
              <label class="form-label small fw-bold">New Password</label>
              <input type="password" name="newPassword" class="form-control form-control-sm" placeholder="Enter new password">
            </div>
          </div>

          <button type="submit" class="btn btn-primary w-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
            <i class="bi bi-save me-1"></i> Update
          </button>
          <button type="button" class="btn btn-outline-secondary w-100 mt-2" id="cancelEditBtn">
            <i class="bi bi-x-circle me-1"></i> Cancel
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
  /* Statistics cards */
  .card.text-white h4 {
    font-size: 1.6rem;
    font-weight: 700;
  }

  .card.text-white .small {
    font-size: 0.9rem;
    font-weight: 600;
  }

  .card.text-white i {
    font-size: 2rem;
    opacity: 0.85;
  }

  .card.text-white .card-body {
    padding: 1.5rem 1rem;
  }
</style>

<script>
  const editBtn = document.getElementById('editProfileBtn');
  const cancelBtn = document.getElementById('cancelEditBtn');
  const form = document.getElementById('profileForm');
  const display = document.getElementById('profileDisplay');

  editBtn.addEventListener('click', () => {
    form.style.display = 'block';
    display.style.display = 'none';
    editBtn.style.display = 'none';
  });

  cancelBtn.addEventListener('click', () => {
    form.style.display = 'none';
    display.style.display = 'block';
    editBtn.style.display = 'inline-block';
  });
</script>
